{% extends "base.html" %}
{% load static %}
{% load mathfilters %}

{% block content %}
<div class="container-fluid">

    <div class="page-title-head d-flex align-items-center">
        <div class="flex-grow-1">
            <h4 class="fs-sm text-uppercase fw-bold m-0">{{TITLE_PAGE}}</h4>
        </div>
    </div>

    <div class="card">
        <form method="POST" action="{% url 'FinanceApp:simulateur_pret' %}"
            class="card-header border-light justify-content-between">

            <div class="d-flex gap-2">
                <div class="">
                    <span class="me-2 fw-semibold">Références du prêt:</span>
                    <div class="d-flex gap-2 mt-2">
                        <div class="app-search">
                            <input type="text" class="form-control number" placeholder="Montant emprunté" name="base"
                                value="{{base|stringformat:"s"}}" required>
                            <i data-lucide="coins" class="app-search-icon text-muted"></i>
                        </div>

                        <div class="app-search">
                            <input type="text" class="form-control taux" placeholder="Taux d'intérêt" name="taux"
                                step="0.01" value="{{taux|stringformat:"s"}}" required>
                            <i data-lucide="percent" class="app-search-icon text-muted"></i>
                        </div>

                        <div class="app-search">
                            <select class="form-select form-control my-1 my-md-0" name="amortissement" required>
                                <option value="">Amortissement</option>
                                {% for amor in amortissements %}
                                <option value="{{ amor.id }}" {% if amor.id == amortissement.id %}selected{% endif %}>
                                    {{ amor.libelle }}</option>
                                {% endfor %}
                            </select>
                            <i data-lucide="settings" class="app-search-icon text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2 border-left border-right">
                <div class="">
                    <span class="me-2 fw-semibold">Etalement du prêt:</span>
                    <div class="d-flex mt-2 align-items-center gap-2">
                        <div class="app-search">
                            <input type="text" class="form-control taux" placeholder="nombre de" value="{{duree}}"
                                name="duree">
                            <i data-lucide="calendar" class="app-search-icon text-muted"></i>
                        </div>

                        <div class="app-search">
                            <select class="form-select form-control my-1 my-md-0" name="modalite_duree">
                                <option value="">Modalité</option>
                                {% for mod in modalites %}
                                <option value="{{ mod.id }}" {% if mod.id == modalite_duree.id %}selected{% endif %}>
                                    {{ mod.libelle2 }}</option>
                                {% endfor %}
                            </select>
                            <i data-lucide="calendar" class="app-search-icon text-muted"></i>
                        </div>

                    </div>
                </div>
            </div>

            <div class="d-flex align-items-center gap-2">
                <button data-bs-toggle="modal" data-bs-target="#modal-new-user" class="btn btn-warning"><i
                        class="ti ti-refresh"></i> Faire une simulation</button>

            </div>
    </div>

    <div class="row row-cols-sm-2 row-cols-md-3 row-cols-1 g-1 p-1 my-3">
        <!-- Total Sales Widget -->
        <div class="col">
            <div class="card rounded-0 border border-dashed mb-0">
                <div class="card-body">
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <h4 class="fs-xxl mb-0">{{base|floatformat:2}} <small>Fcfa</small></h4>
                    </div>
                    <p class="text-muted mb-2"><span>Montant de base</span></p>
                </div>
            </div>
        </div><!-- end col -->

        <!-- Number of Customers Widget -->
        <div class="col">
            <div class="card rounded-0 border border-dashed mb-0">
                <div class="card-body">
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <h5 class="fs-xxl mb-0">{{total_interets|floatformat:2}} <small>Fcfa</small></h5>
                        <span>{{echeances_count}}</span>
                    </div>
                    <p class="text-muted mb-2"><span>Interêts générés ({{taux|floatformat:2}}%)</span></p>
                </div>
            </div>
        </div><!-- end col -->

        <!-- Products Sold Widget -->
        <div class="col">
            <div class="card rounded-0 border border-dashed mb-0">
                <div class="card-body">
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <h5 class="fs-xxl mb-0">{{total_reglement|floatformat:2}} <small>Fcfa</small></h5>
                    </div>
                    <p class="text-muted mb-2 text-truncate"><span>Total à rembourser</span>
                    </p>
                </div>
            </div>
        </div><!-- end col -->

    </div><!-- end row -->

    <div class="card" data-table data-table-rows-per-page="50">
        <div class="card-body border-light justify-content-between">
            <div class="table-responsive">
                <table class="table table-custom table-centered table-select table-hover w-100 mb-0">
                    <thead class="bg-light align-middle bg-opacity-25 thead-sm">
                        <tr class="text-uppercase fs-xxs">
                            <th>Date</th>
                            <th>Principal</th>
                            <th>Intérêt</th>
                            <th>Echéance</th>
                            <th>Restera à payer</th>
                        </tr>
                    </thead><!-- end table-head -->

                    <tbody>
                        {% for ligne in tableaux %}
                        <tr>
                            <td>{{ligne.date}}</td>
                            <td>{{ligne.principal}} Fcfa</td>
                            <td>{{ligne.interet}} Fcfa</td>
                            <td>{{ligne.total}} Fcfa</td>
                            <td>{{ligne.reste}} Fcfa</td>
                        </tr>
                        {% endfor %}
                    </tbody><!-- end table-body -->
                </table><!-- end table -->
            </div>
            <div class="card-footer border-0">
                <div class="d-flex justify-content-between align-items-center">
                    <div data-table-pagination-info="projects"></div>
                    <div data-table-pagination></div>
                </div>
            </div>
        </div>
    </div>
</div><!-- end row -->

{% endblock %}